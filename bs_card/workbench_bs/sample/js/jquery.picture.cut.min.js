$(function(){__IMAGE_LOADING="";PcDialog=function(b,d,a,f,n,k,h,m,p,e){d=null==d?"PictureCutDialog"+Math.round(99*Math.random()):d;$dialog=$("<div></div>").attr({id:d});if(0<$("#"+d).size()){return!1}$dialog.css({overflow:"hidden","background-image":"url("+__IMAGE_LOADING+")","background-repeat":"no-repeat","background-position":"center"});$("body").prepend($dialog);$dialog.dialog({draggable:h,modal:k,width:f,height:n,title:a,resizable:m,zIndex:100,close:function(a,b){$(this).dialog("destroy").remove()}});p=null==p?{}:p;$.post(b,p,function(a){$dialog.html(a);$dialog.css({"background-image":"none"});"function"==typeof e&&e.call(this,$dialog)})};PcAlert=function(b,d,a){a="undefined"==typeof a?function(){}:a;d="undefined"==typeof a?"":d;$Dialog=$('<div id="dialog-PcAlert" ></div>').html(b).css({padding:"15px","max-height":405,overflow:"auto"});$("body").prepend($Dialog);$Dialog.dialog({modal:!0,resizable:!1,zIndex:100,width:450,title:d,buttons:{Ok:function(){$(this).dialog("destroy").remove();"function"==typeof a&&a.call(this)}},beforeClose:function(a,b){$(this).dialog("destroy").remove()}})};PcLoading={show:function(b,d){var a=$("<div id='dialog-UiConfirm' ></div>");b="undefined"==typeof b?"Wait...":b;d="undefined"==typeof d?"Wait!":d;var f=$("<div></div>").css("margin","15px"),n=$("<img src='"+__IMAGE_LOADING+"' >").css({"float":"left","margin-right":"20px","margin-top":"-5px"});$MsgContent=$("<div>"+b+"</div>");f.append(n).append($MsgContent);a.append(f);$("body").prepend(a);a.dialog({modal:!0,resizable:!1,zIndex:100,width:450,title:d,create:function(a,b){$(this).parent().children(".ui-dialog-titlebar").children(".ui-dialog-titlebar-close").hide()}})},hide:function(){var b=$("#dialog-UiConfirm");0<b.size()&&b.dialog("destroy").remove()}}});(function(b){var d;b.fn.uploadAjax=function(a){var f=b.extend({accept:/^(jpg|png|gif)/gi,acceptEx:"",name:"file",method:"POST",url:"/",data:!1,onSubmit:function(){return!0},onComplete:function(){return!0},extError:function(){return!1}},a);return this.each(function(){var a=b(this);a.css("position","relative");a.setData=function(a){f.data=a};var k=b('<form  method="'+f.method+'" enctype="multipart/form-data" action="'+f.url+'"> <input name="'+f.name+'" type="file" accept="'+f.acceptEx+'" /></form>'),h=k.find("input[name="+f.name+"]");h.css({display:"block",position:"absolute",left:0,top:0,width:a.width(),height:a.height(),"font-size":"100pt",cursor:"hand",opacity:0,filter:"alpha(opacity=0)","z-index":10,overflow:"hidden"}).attr("title","Choose a picture");h.on("change",function(d){d=h.val().replace(/C:\\fakepath\\/i,"");d=d.substring(d.lastIndexOf(".")+1);if(!f.accept.test(d)){return f.extError.call(a,this),k.get(0).reset(),!1}k.find("input[type=hidden]").remove();f.onSubmit.call(a,b(this));f.data&&b.each(f.data,function(a,c){k.append(b('<input type="hidden" name="'+a+'" value="'+c+'">'))});k.submit();b(k).find("input[type=file]").attr("disabled","disabled")});b(a).append(k);d||(d=b('<iframe id="picture-element-iframe" name="picture-element-iframe"></iframe>').attr("style",'style="width:0px;height:0px;border:0px solid #fff;"').hide(),d.attr("src",""),b(document.body).append(d));var m=function(){b(k).find("input[type=file]").removeAttr("disabled");var h=b(this).contents().find("html body").text();b(k).get(0).reset();f.onComplete.call(a,h);d.unbind()};k.submit(function(a){d.load(m);k.attr("target","picture-element-iframe");a.stopPropagation()})})}})(jQuery);(function(b){var d={clear:function(a){return this.each(function(){b(this).find(".picture-element-image-directory").val("").change()})},init:function(a){var d={Extensions:["jpg","png","gif"],InputOfImageDirectory:"image",InputOfImageDirectoryAttr:{},InputOfFile:"",ActionToSubmitUpload:"",ActionToSubmitCrop:"",FolderOnServer:"",ThumbFolderOnServer:"",DataPost:{},DefaultImageButton:"",EnableCrop:!1,EnableResize:!0,MinimumWidthToResize:1024,MinimumHeightToResize:630,MaximumSize:1024,EnableMaximumSize:!1,PluginFolderOnServer:"",CropWindowStyle:"bootstrap",ImageNameRandom:!0,EnableButton:!1,ImageButtonCSS:{border:"1px #CCC solid",width:170,height:150},CropModes:{widescreen:!0,letterbox:!0,free:!0},CropOrientation:!0,UploadedCallback:function(a){}};void 0!=a.ImageButtonCSS&&(a.ImageButtonCSS=b.extend(d.ImageButtonCSS,a.ImageButtonCSS));a=b.extend(d,a);void 0!=a.CropModes&&(a.CropModes=b.extend(d.CropModes,a.CropModes));if(""==a.FolderOnServer){return alert("ATTENTION:\nFolderOnServer parameter must be set"),!1}if(""==a.PluginFolderOnServer){return alert("ATTENTION:\nPluginFolderOnServer parameter must be set"),!1}0<a.PluginFolderOnServer.length&&("/"!=a.PluginFolderOnServer.charAt(a.PluginFolderOnServer.length-1)&&(a.PluginFolderOnServer+="/"),"/"!=a.PluginFolderOnServer.charAt(0)&&(a.PluginFolderOnServer="/"+a.PluginFolderOnServer));a.ActionToSubmitUpload=""==a.ActionToSubmitUpload?a.PluginFolderOnServer+"src/php/upload.php":a.ActionToSubmitUpload;a.ActionToSubmitCrop=""==a.ActionToSubmitCrop?a.PluginFolderOnServer+"src/php/crop.php":a.ActionToSubmitCrop;a.DefaultImageButton=""==a.DefaultImageButton?a.PluginFolderOnServer+"src/img/icon_add_image2.png":a.DefaultImageButton;a.CropWindowStyle=a.CropWindowStyle.toLowerCase();""==a.InputOfFile&&(a.InputOfFile="file-"+a.InputOfImageDirectory);__IMAGE_LOADING=a.PluginFolderOnServer+"src/img/ajaxloader.gif";void 0!=a.PastaCrop&&(a.PluginFolderOnServer=a.PastaCrop);"bootstrap"==a.CropWindowStyle.toLowerCase()&&0==b("#picture_element_css_to_bootstrap").size()&&b("<link/>",{id:"picture_element_css_to_bootstrap",rel:"stylesheet",type:"text/css",href:a.PluginFolderOnServer+"src/windows/JanelaBootstrap/jquery-ui-1.10.0.custom.css"}).appendTo("head");0==b("#picture_basic_dependence_css").size()&&b('<style type="text/css" id="picture_basic_dependence_css">.picture-element-principal{background:url('+a.DefaultImageButton+") no-repeat 50% 50%}.picture-dropped{border:2px #666 dashed!important;}</style>").appendTo("head");return this.each(function(){var d,f={jqueryui:"src/windows/window.jqueryui.php",popstyle:"src/windows/window.popstyle.php",bootstrap:"src/windows/window.bootstrap.php"},h;JpaneDialogCrop=function(d,c,f,l,k,h,s,r,q){$dialog=b("<div id='JtuyoshiCrop' class='JtuyoshiContainerElement' ></div>");c=(b(window).width()-f)/2;h=(b(window).height()-l)/2;$dialog.css({position:"absolute",left:c,top:h,width:f,height:l,border:"1px #CCC solid","background-color":"#FFF","background-image":"url("+__IMAGE_LOADING+")","background-repeat":"no-repeat","background-position":"center","z-index":600,"-webkit-box-shadow":"0px 0px 80px 0px rgba(0, 0, 0, 0.7)","box-shadow":"0px 0px 80px 0px rgba(0, 0, 0, 0.7)"});f=b("<div id='JtuyoshiCrop_model' />").css({position:"absolute",left:0,top:0,width:"100%",height:"100%",border:"1px #CCC solid","background-image":"url("+__IMAGE_LOADING+")","background-image":"url("+a.PluginFolderOnServer+"src/img/fundo_crop.png)","z-index":598});k&&b("body").append(f);b("body").append($dialog);b.post(d,r,function(a){$dialog.html(a);$dialog.css({"background-image":"none"});"function"==typeof q&&q.call(this,$dialog)})};var m=function(d,c){var h=function(d,f){var l,g;g=c.currentWidth/100*80;var e=g/16*9;d.css({width:g,height:e,left:(c.currentWidth-g)/2,top:(c.currentHeight-e)/2});l=b("#JtuyoshiCrop #SelectProporcao");g=b("#JtuyoshiCrop #SelectOrientacao");if("create"==f){if(a.CropModes.widescreen||a.CropModes.letterbox||a.CropModes.free?l.show():(l.hide(),g.parent().hide(),g.hide(),g.parent().hide()),a.CropModes.widescreen&&l.append(b('<option value="wide">16:9</option>')),a.CropModes.letterbox&&l.append(b('<option value="box">4:3</option>')),a.CropModes.free&&l.append(b('<option value="livre">Free</option>')),a.CropModes.widescreen||a.CropModes.letterbox&&a.CropOrientation?g.append('<option value="Horizontal">Landscape</option>').append('<option value="Vertical">Portrait</option>  '):(g.append('<option value="Horizontal" selected>Portrait</option>'),g.hide(),g.parent().hide()),0<l.find("option").size()&&l.find("option:first-child").attr("selected","selected"),d.draggable({containment:"parent"}),"livre"==l.val()){e=g=c.currentWidth/100*80,d.css({width:g,height:e,left:(c.currentWidth-g)/2,top:(c.currentHeight-e)/2}),d.resizable({containment:"parent",minWidth:g/100*10,minHeight:e/100*10})}else{var h=0;"wide"==l.val()?(h=16/9,g=c.currentWidth/100*80,e=g/16*9):(h=4/3,g=c.currentWidth/100*80,e=g/4*3);d.css({width:g,height:e,left:(c.currentWidth-g)/2,top:(c.currentHeight-e)/2});d.resizable({containment:"parent",aspectRatio:h,minWidth:g/100*10,minHeight:e/100*10})}}e>c.currentHeight&&(e=c.currentHeight/100*80,g=16*e/9,d.css({width:g,height:e,left:(c.currentWidth-g)/2,top:(c.currentHeight-e)/2}));l.change()},l=function(){if(410<c.currentWidth+80){if("jqueryui"==a.CropWindowStyle){b("#JtuyoshiCrop").dialog("option",{width:c.currentWidth+40,height:c.currentHeight+110}),b("#JtuyoshiCrop").dialog("option","position",{my:"center",at:"center",of:window})}else{if("popstyle"==a.CropWindowStyle){var d=(b(window).width()-c.currentWidth)/2,e=(b(window).height()-c.currentHeight)/2;b("#JtuyoshiCrop").css({width:c.currentWidth,height:c.currentHeight,left:d,top:e})}else{"bootstrap"==a.CropWindowStyle&&(b("#JtuyoshiCrop").dialog("option",{width:c.currentWidth+40,height:c.currentHeight+130}),b("#JtuyoshiCrop").dialog("option","position",{my:"center",at:"center",of:window}))}}}else{"jqueryui"==a.CropWindowStyle?(b("#JtuyoshiCrop").dialog("option",{width:410,height:c.currentHeight+110}),b("#JtuyoshiCrop").dialog("option","position",{my:"center",at:"center",of:window})):"popstyle"==a.CropWindowStyle?(d=(b(window).width()-410)/2,e=(b(window).height()-c.currentHeight)/2,b("#JtuyoshiCrop").css({width:410,height:c.currentHeight,left:d,top:e})):"bootstrap"==a.CropWindowStyle&&(b("#JtuyoshiCrop").dialog("option",{width:410,height:c.currentHeight+130}),b("#JtuyoshiCrop").dialog("option","position",{my:"center",at:"center",of:window}))}},m=function(b,d){b.css({border:"2px #ccc solid",width:c.currentWidth,height:c.currentHeight});d.css({width:c.currentWidth,height:c.currentHeight}).attr("src",a.FolderOnServer+c.currentFileName+"?"+Math.round(9999*Math.random()))},n=function(){b.getScript(a.PluginFolderOnServer+"src/windows/core/window.pc.js");var f=b("#JtuyoshiCrop #Principal"),k=b("<img />");f.append(k);m(f,k);h(b("#JtuyoshiCrop #SelecaoRecorte"),"create");l();b("#JtuyoshiCrop #button_crop_original").bind("click",function(){p(d,c,1)});b("#JtuyoshiCrop #button_crop_recortar").bind("click",function(){var d=b(this);d.attr("disabled","disabled");PcLoading.show();var e=c;e.request="crop";e.folderOnServer=a.FolderOnServer;e.inputOfFile=a.InputOfFile;e.maximumSize=a.MaximumSize;e.enableMaximumSize=a.EnableMaximumSize;e.toCropImgX=b("#JtuyoshiCrop #SelecaoRecorte").position().left;e.toCropImgY=b("#JtuyoshiCrop #SelecaoRecorte").position().top;e.toCropImgW=b("#JtuyoshiCrop #SelecaoRecorte").width();e.toCropImgH=b("#JtuyoshiCrop #SelecaoRecorte").height();e.currentFileName=c.currentFileName.substring(c.currentFileName.lastIndexOf("/")+1);b.post(""==a.ActionToSubmitCrop?a.ActionToSubmitUpload:a.ActionToSubmitCrop,e,function(a){d.removeAttr("disabled");PcLoading.hide();c=a;c.currentWidth=parseInt(c.currentWidth);c.currentHeight=parseInt(c.currentHeight);m(f,k);h(b("#JtuyoshiCrop #SelecaoRecorte"));l()},"JSON")})};"jqueryui"==a.CropWindowStyle?PcDialog(a.PluginFolderOnServer+f[a.CropWindowStyle],"JtuyoshiCrop","Crop image",900,555,!0,!0,!1,null,n):"popstyle"==a.CropWindowStyle?JpaneDialogCrop(a.PluginFolderOnServer+f[a.CropWindowStyle],"Crop image",980,555,!0,!1,!1,null,n):"bootstrap"==a.CropWindowStyle&&PcDialog(a.PluginFolderOnServer+f[a.CropWindowStyle],"JtuyoshiCrop","Crop image",900,555,!0,!0,!1,null,n)},p=function(d,c,f){var l=function(){d.children("input[name='"+a.InputOfImageDirectory+"']").val(a.FolderOnServer+c.currentFileName).change();"function"==typeof a.UploadedCallback&&(c.options={FolderOnServer:a.FolderOnServer},a.UploadedCallback.call(this,c))};1!=f&&a.EnableCrop?m(d,c):("jqueryui"==a.CropWindowStyle||"bootstrap"==a.CropWindowStyle?b("#JtuyoshiCrop").dialog("destroy").remove():"popstyle"==a.CropWindowStyle&&(b("#JtuyoshiCrop").remove(),b("#JtuyoshiCrop_model").remove()),l())};b(this).html("");d=b(this);(function(e){e.css(b.extend(a.ImageButtonCSS,{position:"relative",cursor:"pointer",overflow:"hidden"})).addClass("picture-element-principal");e.on("dragenter",function(c){b(c.target).attr("name")==a.InputOfFile?e.addClass("picture-dropped"):e.removeClass("picture-dropped");c.stopPropagation();c.preventDefault()});b(document).on("drop dragend",function(a){console.log(e);e.removeClass("picture-dropped");a.stopPropagation()});e.on("mouseout",function(a){e.removeClass("picture-dropped");a.stopPropagation()});var c=b("<img src='data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==' class='picture-element-image'>");c.css({position:"relative",cursor:"pointer"});c.css({height:a.ImageButtonCSS.height});e.append(c);var f=b("<input type='hidden' name='"+a.InputOfImageDirectory+"' id='"+a.InputOfImageDirectory+"'>");f.addClass("picture-element-image-directory");e.append(f);f.attr(a.InputOfImageDirectoryAttr);f.bind("change",function(){if(""!=b(this).val()){var e;e=""!=a.ThumbFolderOnServer?a.ThumbFolderOnServer+b(this).val().substring(b(this).val().lastIndexOf("/")+1):a.FolderOnServer+b(this).val().substring(b(this).val().lastIndexOf("/")+1);c.removeAttr("style");c.css({position:"relative",cursor:"pointer"});c.attr("src",e);a.EnableButton&&h.unbind("click").bind("click",function(){f.val("").change()}).val("Remove Picture");c.on("load",function(){console.log("load");b(this).height()<b(this).width()?(b(this).css({height:a.ImageButtonCSS.height}),b(this).css({width:"none"})):b(this).width()<b(this).height()?(b(this).css({width:a.ImageButtonCSS.width}),b(this).css({height:"none"})):(b(this).css({width:a.ImageButtonCSS.width}),b(this).css({height:a.ImageButtonCSS.height}))}).each(function(){this.complete&&b(this).load()})}else{c.attr("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),a.EnableButton&&h.unbind("click").bind("click",function(){d.find("input[name='"+a.InputOfFile+"']:file").click()}).val("Selecionar imagem")}})})(d);(function(d){var c=a.DataPost;c.request="upload";c.inputOfFile=a.InputOfFile;c.enableResize=a.EnableResize;c.minimumWidthToResize=a.MinimumWidthToResize;c.minimumHeightToResize=a.MinimumHeightToResize;c.folderOnServer=a.FolderOnServer;c.imageNameRandom=a.ImageNameRandom;c.maximumSize=a.MaximumSize;c.enableMaximumSize=a.EnableMaximumSize;var f=new RegExp("^("+a.Extensions.join("|")+")","i");d.uploadAjax({accept:f,acceptEx:"image/*",name:a.InputOfFile,method:"POST",url:a.ActionToSubmitUpload,data:c,onSubmit:function(){PcLoading.show()},onComplete:function(a){a=b.parseJSON(a);PcLoading.hide();a.status?p(d,a):PcAlert(a.errorMessage,"Attention")},extError:function(){PcAlert("types are supported: "+a.Extensions.join(",").toString(),"Attention")}});d.find(":file[name='"+a.InputOfFile+"']").mouseenter(function(){d.addClass("TuyoshiImageUpload_div")}).mouseout(function(){d.removeClass("TuyoshiImageUpload_div")})})(d);a.EnableButton&&(h=b("<input type='button' value='Selecionar imagem' />").button().css({"font-size":"12px","margin-top":5,"margin-left":"-0.5px"}),d.after(h),h.unbind("click").bind("click",function(){d.find("input[name='"+a.InputOfFile+"']:file").click()}))})}};b.fn.PictureCut=function(a){if(void 0===window.jQuery.ui){alert("Could not instantiate the PictureCut is missing jquery.ui")}else{if(d[a]){return d[a].apply(this,Array.prototype.slice.call(arguments,1))}if("object"===typeof a||!a){return d.init.apply(this,arguments)}}}})(jQuery);